<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.base.framework.miniProgram.mapper.MPHospitalMapper">

    <select id="getHospitalDetailByCode" resultType="com.base.framework.miniProgram.model.entity.MPHospitalEntity">
        SELECT
            mh.id,
            mh.name,
            mh.code,
            mh.description,
            mh.address,
            mh.feature,
            mh.disease_type AS diseaseType,
            mh.department_ids AS departmentIds,
            mh.consultation_hours AS consultationHours,
            mh.intro_pic AS introPic,
            mh.env_pic AS envPic,
            mh.ext,
            mh.is_show_doctor_column AS isShowDoctorColumn,
            sa.phone
        FROM
            m_hospital mh
        LEFT JOIN sys_account sa ON mh.account_id = sa.id
        WHERE
            mh.code = #{code} AND mh.is_active = 1
    </select>

    <select id="getDetailByCode"  resultType="com.base.framework.miniProgram.model.entity.MPHospitalEntity">
        SELECT
            id,
            account_id AS accountId,
            name,
            is_show_doctor_column AS isShowDoctorColumn,
            recipient,
            appid,
            secret
        FROM
            m_hospital
        WHERE
            code = #{code} AND is_active = 1
    </select>

    <update id="saveAuthNumber">
        UPDATE m_hospital SET auth_number = IFNULL(auth_number, 0) + 1 WHERE id = #{hospitalId}
    </update>


</mapper>
