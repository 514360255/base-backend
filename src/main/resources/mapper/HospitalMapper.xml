<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.base.framework.admin.mapper.HospitalMapper">

    <insert id="save" parameterType="com.base.framework.admin.model.entity.HospitalEntity" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO
            m_hospital(id, name, code, description, address, department_id, account_id, is_active, created_by)
        VALUES
            (#{id}, #{name}, #{code}, #{description}, #{address}, #{departmentId}, #{accountId}, #{isActive}, #{createdBy})
    </insert>

    <select id="queryHospitalPage" resultType="com.base.framework.admin.model.entity.HospitalEntity">
        SELECT
            mh.id,
            mh.name,
            mh.code,
            mh.department_id As departmentId,
            mh.is_active AS isActive,
            mh.created_at AS createdAt,
            mh.created_by AS createdBy,
            sd.name AS department
        FROM
            m_hospital mh
        LEFT JOIN sys_dict sd ON sd.id = mh.department_id
        <where>
            mh.is_deleted = 1 AND mh.deleted_at IS NULL
            <if test="name != null and name != ''">
                AND mh.`name` LIKE CONCAT('%', #{name}, '%')
            </if>
            <if test="isActive != null">
                AND mh.is_active = #{isActive}
            </if>
            <if test="accountId != null and accountId != ''">
                AND mh.account_id = #{accountId}
            </if>
            <if test="department != null and department != ''">
                AND mh.department_id = #{department}
            </if>
        </where>
    </select>

    <select id="getHospitalDetail" resultType="com.base.framework.admin.model.entity.HospitalEntity">
        SELECT
            mh.id,
            mh.name,
            mh.code,
            mh.department_id AS departmentId,
            mh.address,
            mh.description,
            mh.is_active AS isActive,
            mh.created_at AS createdAt,
            mh.created_by AS createdBy,
            sd.name AS department
        FROM
            m_hospital mh
        LEFT JOIN sys_dict sd ON sd.id = mh.department_id
        WHERE
            mh.code = #{code} OR mh.id = #{id}
    </select>

    <update id="deleteHospital">
        UPDATE
            m_hospital
        SET
            deleted_by = #{createdBy},
            deleted_at = now(),
            is_deleted = 0
        WHERE
            id = #{id}
    </update>

    <update id="updateState">
        UPDATE
            m_hospital
        SET
            updated_by = #{updatedBy},
            updated_at = now(),
            is_active = #{isActive}
        WHERE
            id = #{id}
    </update>

    <update id="update">
        UPDATE
            m_hospital
        SET
            name = #{name},
            address = #{address},
            department_id = #{departmentId},
            description = #{description},
            updated_by = #{updatedBy},
            updated_at = now(),
            is_active = #{isActive}
        WHERE
            id = #{id}
    </update>

</mapper>
